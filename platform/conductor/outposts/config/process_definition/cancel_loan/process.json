{
  "ownerApp": null,
  "createTime": 1725524755533,
  "updateTime": 1727010366455,
  "createdBy": "Ahmed.Ghazey@btech.com",
  "updatedBy": "mina.ishak@btech.com",
  "name": "cancel_loan",
  "description": "Workflow to cancel loan",
  "version": 21,
  "tasks": [
    {
      "name": "prerequisites",
      "taskReferenceName": "prerequisites_ref",
      "description": null,
      "inputParameters": {},
      "type": "FORK_JOIN",
      "dynamicTaskNameParam": null,
      "caseValueParam": null,
      "caseExpression": null,
      "scriptExpression": null,
      "dynamicForkJoinTasksParam": null,
      "dynamicForkTasksParam": null,
      "dynamicForkTasksInputParamName": null,
      "forkTasks": [
        [
          {
            "name": "is_consumer_active",
            "taskReferenceName": "is_consumer_active",
            "description": null,
            "inputParameters": {
              "consumer_id": "${workflow.input.cancel_loan_details.consumer_id}"
            },
            "type": "SIMPLE",
            "dynamicTaskNameParam": null,
            "caseValueParam": null,
            "caseExpression": null,
            "scriptExpression": null,
            "dynamicForkJoinTasksParam": null,
            "dynamicForkTasksParam": null,
            "dynamicForkTasksInputParamName": null,
            "startDelay": 0,
            "subWorkflowParam": null,
            "sink": null,
            "optional": false,
            "taskDefinition": null,
            "rateLimited": null,
            "asyncComplete": false,
            "loopCondition": null,
            "retryCount": null,
            "evaluatorType": null,
            "expression": null
          }
        ],
        [
          {
            "name": "is_partner_active",
            "taskReferenceName": "is_partner_active",
            "description": null,
            "inputParameters": {
              "partner_id": "${workflow.input.cancel_loan_details.merchant_id}"
            },
            "type": "SIMPLE",
            "dynamicTaskNameParam": null,
            "caseValueParam": null,
            "caseExpression": null,
            "scriptExpression": null,
            "dynamicForkJoinTasksParam": null,
            "dynamicForkTasksParam": null,
            "dynamicForkTasksInputParamName": null,
            "startDelay": 0,
            "subWorkflowParam": null,
            "sink": null,
            "optional": false,
            "taskDefinition": null,
            "rateLimited": null,
            "asyncComplete": false,
            "loopCondition": null,
            "retryCount": null,
            "evaluatorType": null,
            "expression": null
          }
        ]
      ],
      "startDelay": 0,
      "subWorkflowParam": null,
      "sink": null,
      "optional": false,
      "taskDefinition": null,
      "rateLimited": null,
      "asyncComplete": false,
      "loopCondition": null,
      "retryCount": null,
      "evaluatorType": null,
      "expression": null
    },
    {
      "name": "prerequisites_join",
      "taskReferenceName": "prerequisites_join_ref",
      "description": null,
      "inputParameters": {},
      "type": "JOIN",
      "dynamicTaskNameParam": null,
      "caseValueParam": null,
      "caseExpression": null,
      "scriptExpression": null,
      "dynamicForkJoinTasksParam": null,
      "dynamicForkTasksParam": null,
      "dynamicForkTasksInputParamName": null,
      "startDelay": 0,
      "subWorkflowParam": null,
      "joinOn": [
        "is_consumer_active",
        "is_partner_active"
      ],
      "sink": null,
      "optional": false,
      "taskDefinition": null,
      "rateLimited": null,
      "asyncComplete": false,
      "loopCondition": null,
      "retryCount": null,
      "evaluatorType": null,
      "expression": null
    },
    {
      "name": "lms_cancel_loan",
      "taskReferenceName": "lms_cancel_loan",
      "description": null,
      "inputParameters": {
        "cancel_loan_details": "${workflow.input.cancel_loan_details}"
      },
      "type": "SIMPLE",
      "dynamicTaskNameParam": null,
      "caseValueParam": null,
      "caseExpression": null,
      "scriptExpression": null,
      "dynamicForkJoinTasksParam": null,
      "dynamicForkTasksParam": null,
      "dynamicForkTasksInputParamName": null,
      "startDelay": 0,
      "subWorkflowParam": null,
      "sink": null,
      "optional": false,
      "taskDefinition": null,
      "rateLimited": null,
      "asyncComplete": false,
      "loopCondition": null,
      "retryCount": null,
      "evaluatorType": null,
      "expression": null
    },
    {
      "name": "create_invoicing_transaction_record_task",
      "taskReferenceName": "create_invoicing_transaction_record_task",
      "description": null,
      "inputParameters": {
        "reference_id": "${lms_cancel_loan.output.loan_id}",
        "payment_account_id": "${lms_cancel_loan.output.merchant_account_id}",
        "payable_units": "${lms_cancel_loan.output.merchant_cancellable_amount}",
        "payable_currency": "EGP",
        "narration_comment": "Loan cancellation ${lms_cancel_loan.output.loan_id}",
        "transaction_date": "${workflow.input.cancel_loan_details.cancellation_time}"
      },
      "type": "SIMPLE",
      "dynamicTaskNameParam": null,
      "caseValueParam": null,
      "caseExpression": null,
      "scriptExpression": null,
      "dynamicForkJoinTasksParam": null,
      "dynamicForkTasksParam": null,
      "dynamicForkTasksInputParamName": null,
      "startDelay": 0,
      "subWorkflowParam": null,
      "sink": null,
      "optional": false,
      "taskDefinition": null,
      "rateLimited": null,
      "asyncComplete": false,
      "loopCondition": null,
      "retryCount": null,
      "evaluatorType": null,
      "expression": null
    },
    {
      "name": "check_cancelation_reason",
      "taskReferenceName": "check_cancelation_reason",
      "description": null,
      "inputParameters": {
        "cancelation_reason": "${workflow.input.cancel_loan_details.reason}"
      },
      "type": "SWITCH",
      "dynamicTaskNameParam": null,
      "caseValueParam": null,
      "caseExpression": null,
      "scriptExpression": null,
      "decisionCases": {
        "PRODUCT_RETURN": [
          {
            "name": "product_return",
            "taskReferenceName": "product_return_ref",
            "description": null,
            "inputParameters": {},
            "type": "FORK_JOIN",
            "dynamicTaskNameParam": null,
            "caseValueParam": null,
            "caseExpression": null,
            "scriptExpression": null,
            "dynamicForkJoinTasksParam": null,
            "dynamicForkTasksParam": null,
            "dynamicForkTasksInputParamName": null,
            "forkTasks": [
              [
                {
                  "name": "vas_update_consumer_credit_limit",
                  "taskReferenceName": "vas_update_consumer_credit_limit",
                  "description": null,
                  "inputParameters": {
                    "amount": "${lms_cancel_loan.output.loan_amount}",
                    "consumer_id": "${workflow.input.cancel_loan_details.consumer_id}",
                    "direction": "INCREASE"
                  },
                  "type": "SIMPLE",
                  "dynamicTaskNameParam": null,
                  "caseValueParam": null,
                  "caseExpression": null,
                  "scriptExpression": null,
                  "dynamicForkJoinTasksParam": null,
                  "dynamicForkTasksParam": null,
                  "dynamicForkTasksInputParamName": null,
                  "startDelay": 0,
                  "subWorkflowParam": null,
                  "sink": null,
                  "optional": false,
                  "taskDefinition": null,
                  "rateLimited": null,
                  "asyncComplete": false,
                  "loopCondition": null,
                  "retryCount": null,
                  "evaluatorType": null,
                  "expression": null
                }
              ],
              [
                {
                  "name": "send_return_sms",
                  "taskReferenceName": "send_return_sms",
                  "description": null,
                  "inputParameters": {
                    "loan_id": "${lms_cancel_loan.output.loan_id}"
                  },
                  "type": "SIMPLE",
                  "dynamicTaskNameParam": null,
                  "caseValueParam": null,
                  "caseExpression": null,
                  "scriptExpression": null,
                  "dynamicForkJoinTasksParam": null,
                  "dynamicForkTasksParam": null,
                  "dynamicForkTasksInputParamName": null,
                  "startDelay": 0,
                  "subWorkflowParam": null,
                  "sink": null,
                  "optional": false,
                  "taskDefinition": null,
                  "rateLimited": null,
                  "asyncComplete": false,
                  "loopCondition": null,
                  "retryCount": null,
                  "evaluatorType": null,
                  "expression": null
                }
              ]
            ],
            "startDelay": 0,
            "subWorkflowParam": null,
            "sink": null,
            "optional": false,
            "taskDefinition": null,
            "rateLimited": null,
            "asyncComplete": false,
            "loopCondition": null,
            "retryCount": null,
            "evaluatorType": null,
            "expression": null
          },
          {
            "name": "product_return_join",
            "taskReferenceName": "product_return_join_ref",
            "description": null,
            "inputParameters": {},
            "type": "JOIN",
            "dynamicTaskNameParam": null,
            "caseValueParam": null,
            "caseExpression": null,
            "scriptExpression": null,
            "dynamicForkJoinTasksParam": null,
            "dynamicForkTasksParam": null,
            "dynamicForkTasksInputParamName": null,
            "startDelay": 0,
            "subWorkflowParam": null,
            "joinOn": [
              "vas_update_consumer_credit_limit",
              "send_return_sms"
            ],
            "sink": null,
            "optional": false,
            "taskDefinition": null,
            "rateLimited": null,
            "asyncComplete": false,
            "loopCondition": null,
            "retryCount": null,
            "evaluatorType": null,
            "expression": null
          }
        ]
      },
      "dynamicForkJoinTasksParam": null,
      "dynamicForkTasksParam": null,
      "dynamicForkTasksInputParamName": null,
      "startDelay": 0,
      "subWorkflowParam": null,
      "sink": null,
      "optional": false,
      "taskDefinition": null,
      "rateLimited": null,
      "asyncComplete": false,
      "loopCondition": null,
      "retryCount": null,
      "evaluatorType": "javascript",
      "expression": "$.cancelation_reason"
    }
  ],
  "inputParameters": [
    "cancel_loan_details"
  ],
  "outputParameters": {},
  "failureWorkflow": null,
  "schemaVersion": 2,
  "restartable": true,
  "workflowStatusListenerEnabled": false,
  "ownerEmail": "ibrahim.awad@btech.com",
  "timeoutPolicy": "TIME_OUT_WF",
  "timeoutSeconds": 0,
  "variables": {},
  "inputTemplate": {}
}